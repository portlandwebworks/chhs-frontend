language: java
jdk:
- oraclejdk8
services:
- docker
cache:
  directories:
  - $HOME/.m2
sudo: false
install: true
env:
  global:
  - CLOUDSDK_CORE_DISABLE_PROMPTS=1
  - secure: rY7l7UktPshXAzN1coCqkDl+1aWN4Imwm6BNQtUBwIwjVlVkFLCasrZ0T/M0hu9q83YyHJrTVpxNUHvqc3OnsQ8mchicmsipES/vE+/ODKV9vAXemTZ+Rr2sSKxj76v9CPmiTctTHRP+gGsw4FqYSa+r8JngVsmCtH1McNGKIqoRYGnXZhlxC0JCg8CTjNuOyOs0g40k7+4wF7wOD5umKAYA3nB/6kdtpTsqofmhisFQtiU5AEUhP4ZgXACWWsQSUQ/XDMVU2cLexFL8+okSMvHScdhDJcEasbO7Dtt93/p7Fgr9UzMpMLCyAdQw5RL3IWR8OLmnZFFesQywmYqXN02TwPcf7sDrUGRvV+PUOX/TCPSqOwytoBAzVP/2hbqb2L/ujh7TJqPJuCLlJenR5ELTHJsSgQZN/jc7QmCi/8+1auBj++q3bqUXa56DV2e9QMY78GWecoiiN+eua8ZCjXj+T20RiynOPhniNVZw/aCkmURW2+z0CJo6dD+cE8uGlPW5jBdfFGxl6p5O6WJuL86Sm1luxK/IY3YBCNmIf325UlfktZo0Zd9I2ZL3NM1fNT+VuMATOUBuULTpMppUYhDuaHRFiPPIdq4TzBM7q9L/zgV9qvkmLSpsUyLGqOCBx+9R3fYJBnTpSgjzfisA8o3uYp4I0E+iG4cQQQWhyiY=
  - secure: k7bRhL8QMClOXaGtRC523jOJHI3jpfn4JX/2YBSPSQhxcZFooYRbz5mK3m0T6yvXotMh++uNKyW30A3x/Ea2oSjyD3o1CevtEA96BWwpK92OE+cGZW+AD8ifNPOlBQ3HxXUNL+PUyhFuN6JQOL5ZKUTZB36nFlDX1ZRsvwcce49bwkyq7BXv+zAy7koJC1BP6kPNWbS5j9dI0pyI+ltBUK9hKQD0tZOEaDQ4mxP2KicjCcexe7assOKXTXJu+tvRJIQIqLXAPmDHMzImSY/sjVPbzSENPmxJhiFmaN6WVdh02XN4PQP7ZzvFnJGCS+aDlDDawYJrxpgwoew2K9KC9LnXJsuRYuYQsSTUN+UPmWJ3enE1vWIKpmiMIE+0zVLDjl6xK9+QOy9QaGPRZuJ78GvWRM0ub7oEoCoMHTTwYXys6NDdS+tF0qHIJOQRaeAUrFeojpToXZGDmtz3kIzVzG1uZN49LVYXyVuuxNhfeH+DAOB8NLzXwCwyt8HczEFP3ehNfS7Bu4R7rHKvaBsmJLf9NgaZp8/qcmtHZrJEcbiremHVUtmyjr1SZhvpzBdJHrMW2tuSMSUKOcJ3i3UOTA6s4TBRpry+Qz/fEmPJzlPmmtnjHVHAOHZCa7+/SMWCKr7E00dfw+JoBOM3SlP33pCBPBerYujR6lwumKVaZ3U=
  - secure: JmoopBC0c0n4i05Vsw8gw+9gYuudNM611HHr//8uyxaLmMZVh9yFgKzOziOFmCzDGf3Whjdi1w1K2R1LrMBzKEF+2RCYVgQs5hFngtvIDNqou2yPVFURwx1veKO8325Vukn4uuefu/clqHbNx4b+MBreGdVf9v+CgZKmuK4ggK5sX7qCKMlkggQugDaSNPO5cvND8avPMSqkF5f1SP0n28eoLwm2GGUIe4/8z7t7Qrk3qvwSxsUAEFXyeq87fETz9Cj6RqypIWAzUxfczb2xsl5aY+mvVbY+7y+8M+Baq+3eqyS9DjEgkHnS6Guyl8pBl8IP1AD6zDriXz2OC01J0crCwc7cOynIJtcG014Xq8DwlrPhej4R6/TQcQfwUNNy873ELEJt9uGkQj2YAgwZX2hdGVgIWqXoQ6xH8spMWhE6K1nxgzP/0xQvyuyNfR2SK7nI2RNmnmXZHlihvia3L5AD++4/mKLYA2Ht1ni1jTwQlYhfOPLoB6vYBgSQ3gviZtd74e+sw91RPcGgDpRyY/4Okh2CNr4GUnZrV/0ngU67QKfafw2qhiDIUnj8qw6eURor3Zl6UEw3mqnnBAleKXSBRDOjQyODPi54Pu+AtJUBTyCJ7W81Rw+eIqJIyzP3ryDQ4dt4l0BuoxhVWs7t2rA+i5Tsd1HIvN4AOo91G/8=
  - secure: fcKTY5qS8xqNJ5JWv/psTpwlkWoj9yY5bGsr2ZlwCJXI2Bg8N/CJtMXbQPSo1lhekkCaR2MpKcanK2GX08n+wqgzI0T5dGa67/umTSzXBODu5eyjur/XBOHxjHnpl06+K1G5gpvAKSxid9asldaRZw+0Fn0NG7lJpd7bFGHOgm/2L5KOmfc/WXzf1/ReLzr5VQEzYb0FC+cODPJkWk9+39u9KBxEmrAgsxJ1KQIU6vdKRFpAKb7suedYJdYhvgxo8vnk+77b8VnNlXHJySgNss6te+FXeADnKlXwh1EXY42qaLAXmKJCzLFlWPZWsb0bdTs7QT5394wjTQkBWzlWeORUMq0kla1mjBqrHVnDIYGpznwWeS+1HlA3ZfA4XJOAU/FSbx8VKWtEo7+FCgMQCvqRrHWLu4CEzRcDRWZxe2SqI0vyoEfogJKH+dlja2O5HWiYkt9Oj3kJ8kHsCLHqmt849sTMHL0kBlgfjZqda+v4Ja9HZjopqaaJypFsh3lEeK7UzatglnmVaoCpqCTDMv0nZq91yrmuA2CISA2rrFBCTQislgzCnGMeKZUnyXDLxzygkqESy3J7PkHCpnBvaQp8FNceG8/9lMSGjWQnyP1qZ6ZdIm5wEZ6c43Za205SBvYtrBnt0qd7rf8FScosFovDq58VQWX0IYtMzGOCm0Q=
  - secure: xG97YmZ6ShzpKnjMJoZ1zc5fhg2F8qPwKa5YYoRApHAPEK657ar+xN3/0+KobEGpbv02YYAGZsA5ECZZqgjehvln783wNFXJu1CeeowYZDwTZVIuMaAOb0zPVg7sYC8nGuoMcxMbR39/1C5DL2VW+2q34ztLW+i8MyF6jnQdD3QYvz77wMjzDa2FApQgHcfGlcti+/OjCtkaVURHrnv3gPfVhsixvajqJH27F6w61keweQg7D3x/sBuqU7yxxjlJ0WPCp3IQRmbZTJ+Ms1l+t9EgeRibdQ6QjAWyD9qHnIpJYfeczKxc2JjIrMZh0uWXBGIx3EsnHaf09+3WlNAyUxCzwfSswlPWfOTbuDzXHKomFl0/OiiRkghhBFdeFDy57sENB2jESbFvcaU/Xy9MICccvTinPK/cmz508VWshSSK6XYLcolp9ZyiPcEFJSdv9WCEHlIocvewgoEDv22potAT412TtFfL1on9B+jjhA+/9fVJYDUwjmCdUUPZGW3EYXDhS6z46RyHc5YpexPi47bAP0mMc5dBuTSgCLLKNrM+8dumFM5QXh6etxjsoGVBP5//9pTqANLUNH2INfyAeGiK47SGofYzs7L5VXQLYpgrTonULseD61lfhX7aOU13WPD9WROS4jk8wlDfgOfsDUsF4bxgayaUmeynV5KENsY=
  - secure: GL2WeB10VbYPky6EmH/A7bdKYXKMOHkmmPZrEPgnoa4f+I2H+z/MAGSidGpMW4vevXRVdMWLGWALBDAMj6K+jk743ftSjiR0huE2ZiNv0Jxj7PLU1muOhtN0SwEKS5Bm97vR/KJRtL3I/U+bgnr2iPHu4whNKcqPeTioov+4PoUa7DnzzKkEZDQ9HJjn1eYdv/IogVSKinUVQrKRFRuJtspP6dF6Sh7W5h712Q/wymYNY7JVCkShjLkZhblU5gDQWrRT19TrAlhKM6J0wvIMZ/WVhSaZdAFylE7ox4A9y7ClSSmG01Y507x6HUEwdZIaBYO746jP2UEUHp7Ldj9jr/8hpWxjlaTGhg7rlzKIcmF7H17af3svp3u8HG+cEEy1P0kARAIPPMTopUDWjhOnN8AW08TYt+b62ZJpfol1G6ydA7FXqDFyURyIyqtJakiUopbdDXn9EmBmVkC62bjDk4epcMS1XS6MrFw92TicNc2/CfkbHsamB1Dt1ioFOlKU24bniQae7lFV9lB7AFd9Y1hc6b84/1lXOeeJoUcolLheRJkWS7/NkLsuEC/Am0ItXm4NIsVmaPPtn10v1/wLvi53gdFJfa1UoKh3cRTuj9W/jg4Nbhlp3NAduOut3KHos2dENx59yoHuOuhc19dP5WDm6B32NmoaPYA4j+osbSI=
  - secure: xzY5L9HrHd2Of7YZE55TCRJmEaOlo180FRActzzhPYLo6zzduf5ecWO4EaKSYres26pbPGsGeCPxrKHTp5Bf8fOeojoc8G4eRy9zejxqOQmcsXQ/2/+IY/caogDykYRo2+3slOpsL8YW/dtawxGyQjBu1EuUt++mBKuCtGvvlKZtgUCMKIcq4Q7+sXyzNmfuaYYC8FnPJusb1gmxFk9EMd3oCtNq/QyG8wFiaI+03N95igp5kPcI/K1SfHLD9iPIiSYy+AAKEYWeE1K4GX8AXHcH5RGxAkZOPxf/Chk1KDptMtqM4i5y7nO1kpzfm34+9tY1Dy+pngYOuUIXnfhMizYdlMdrviw0VLbdCmHgrqWiIHDrLhQksHi/EVZfA9eBf2zAAoo8STbj+CI10sAhFbpflPUjSG7W1nv/MdlMx4IjK9c1yKyV70w8yusGTlR+52jUETOhiHB0oMkr2Fj4ABODX5s96tpCka/CyaMSlOSUGh5mA3997cgupI5Kxk43LfniE9MdjKAJNh88mFn579WDad7MQ7NMrcyQ3wPI9puj3hvCGRwTDh/ricMrw7nA/LvmPPuCM9zY8fAJ/GM6ZxZTOa6DWUr6LlmWSlZkYNqQ+eJM6faq3tEnOmSrHHSiTYFM5BHe5gYJj+Qm8Rb3wodZT1vNSPBcNXbjVJw80Nc=
  - secure: xsGsslRlikMiVXmW6RLhl+U5qyXvWihuA4OUUHg+DJMIgZMEwNapBQYxFwBFmFhxFWXMDLyTI8/SfNGMc0c+Vu7TW4rKMBtJFwrNBfLmIUvWMlAZYI7GxaYVCHjRKbM5l6re+58B40DAw+SZuhVOobL8SjJGSmEHubBbGLaRqO5/VaU4ypKvHoTypv+3piATVQLgZdrLv9ZDsddeSY+txIWybmda07D3fVymSQaQUqc2Cd3wuIySTWh0lUWhClwIq6cvIAeIH2qqgzUcpCwFyeLQ0XaDu+EQZeolFZrwyxFfqRYvDA4GQ3cNIFDSPXlFMsxB5fDpvD6sEVYMI9F+YpzlRQIBgUIR3zQW7WId4X6L6W3EX+OdoRfPwyjOAd0GQbbYmGhRuAEEapvwGXdfwKD6ogghPWQsJoYQdRWPwZfqzz8I7pHQVccCSEPvc8IcbJ6MvfJwVaz/GVPcKj3vELZbALemoQjFdS1yARgBmy5e3TkxktaY92Ymth9Op9PudMfVConfrHdbKK1ytJMpYzgHuF9l6mSuns+XcCmhbfGkKb/nm7Z63hINw8wtaBsbl35xtT6VEhEt4CApJL7/4LLhilePHM7Cl0mgjWaXu2A69xa8ReKm3U2fgkXSTr0vwx278/eDZmBwr9dYZyT+EhUC63rdXkgAVL7NC9b5cJg=
  - secure: eXytHrR6bXmUFN7A2YxbT928MwCBE6vxx7utCMcXJFZw5Tx5HtSP2U+afAafECMUz4aPBP9eH3ucbkK4O43xss4wi6OYGfsBD5QF+AhYKn2DJKyi+RM25MT3CjJ4vaPWcj0OT7Zb0WQY13KiZXC1M8tKwJ2s7bUcfmGOSLRe2oVWiqBTbMzEoPky9TW/qfmlyl/z75KamFyOhZ9Ej0jSSEJig1pqbe0ribrZQZxfFwRlxMeklxdT/Ytoftna31NwiK7U3+JN5e8D2ArzHJLI3KUM69VQNGs9LAUJExQRbzNQccVDABw1/eRgfUNgNXSBCeV0wRgUphqQh9DuA5gqs2HRAv2PCfWYhrY4H/y/33D98DDWFC9QZa2hZ5ii3qn+p4Q7pChtxvjkevwEQZ63Wu5HCDvO7HkyREvsM2TI1ypTUYUgne6Us4rG20No/TevsjDjah9NkSbGY2K7I/Vl2VA01kdBmScCQR3kqQ4VPx24zfXkS7j9+YtK89ta/9FRiuzeMGVWRkcU4Inkf4n4svcWTrqu7AiKJ2QTu+93cun8F/Eyh/IGiduZZ94KkOJXTMWJeRDz/TTOPemdc2WzQbn1l/HdmGP8ApaxmIQ0hrzRgFNizk4bEToGUPiGnQt65bq4tZku0iJk9OJLD5micCSHRdTTJNJFrnOmnVk98SI=
  - secure: kO7Tgmu9rXDrKBiHIBV37RqT3lA0egiQyRZaaG2g9OwT97c+xVj9DvpV64/UQEvj8IuTMmGLhrfWi9BHTl2lDhfyargAl/RN6xOGSy9mXBnYyR8tRSjKT9uR0o9D/sQtr2X8wqNClvpsMmnNbs6zAPQM5A38Nhvp4xvT+TbQ4itmgmU7PQyIfSv+uHdo+wUEGiWqtn5sYqGKc9Mf2EJ9xVAPYgx6D0QW/BS5R2NMBeKCUof5BDk+rK5UhCwn9KmgelSCrm3l2U0k6+7MQvVYVjyUxNrVOKpyygezJf95/L/eA+5oBFOLGtE5VqbrGOb39k9jzOd0IccKdVikNgfM057+nX3KAqPEyjz01m2uc9TeEH2rkzLOXm1Z1TVDOYDJQbsRQr3iX8PaMN1elYpA5I/jGE4SfivUnXYMc2wavDaPZyqlNB/0B9iV1OOUA/ulWtFqax0/EaN5XkDgLbKh8wnJuX13oR/yaUbdOK74d+WrTCZqLlXrosCqT/VLWbOMhja70TMOqJQ6sdfD5q+1wKkHDYjjeq/igbpF48H3yFg6KN23/F33BBWpYSOJHxJoH4pZMtvu6LCiiWlA+cU81WxY3fTgTW0JXAxMPdK6zi4YMQfsEPAXgo7d0F1hRF5zU6W0A3kdS1yaIwWFLisZ70scfNBKpRzxxQ3HMXu1Rpk=
before_script:
- npm install -g bower
script: mvn install -Ppackage spring-boot:repackage
after_success:
- docker login -u $DOCKER_USER -p $DOCKER_PASS
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH
  ; fi`
- export REPO=portlandwebworks/chhs-frontend
- docker tag $REPO $REPO:$TAG
- docker tag $REPO $REPO:travis-$TRAVIS_BUILD_NUMBER
- docker push $REPO
- export REPO=portlandwebworks/chhs-backend
- docker tag $REPO $REPO:$TAG
- docker tag $REPO $REPO:travis-$TRAVIS_BUILD_NUMBER
- docker push $REPO
- curl https://sdk.cloud.google.com | bash
- source /home/travis/.bashrc
- source $HOME/google-cloud-sdk/path.bash.inc
- gcloud components update kubectl
- kubectl config set-credentials default --username=${GKE_USERNAME} --password=${GKE_PASSWORD}
- kubectl config set-cluster default --server=${GKE_SERVER} --insecure-skip-tls-verify=true
- kubectl config set-context default --cluster=default --user=default
- kubectl config use-context default
- kubectl patch deployment frontend-deployment -p '{"spec":{"template":{"spec":{"containers":[{"name":"'"webapp"'","image":"'"portlandwebworks/chhs-frontend:travis-$TRAVIS_BUILD_NUMBER"'"}]}}}}'
- kubectl patch deployment backend-deployment -p '{"spec":{"template":{"spec":{"containers":[{"name":"'"backend"'","image":"'"portlandwebworks/chhs-backend:travis-$TRAVIS_BUILD_NUMBER"'"}]}}}}'
notifications:
  slack:
    on_success: always
    secure: o0MSoIyOs3pAgwmb0JrrrmW/JkwP2R+F9Ftqx8wrz2lXtej/1/MlR/vhkEP8wAhylyn6UkpWC2bvso0QhqalYYwbILna6unZWj1L1J+ue19Np2KtaKkpZjLpr3G5/4wGnHZRI5KyUQPan6e15CBkxp2gQgVF2ISzyqfLMxgdWpfGKAd6CD6Fs+CtYVywVcZn6FUYbITdhdqjE2oQAgqrQgDxM76+vsQwLpDtlk32IP15cgGnFZqn9E7hOK2NWEjfAeUajpg7VEWeWsGiBq7Ead3e9rfA9LtmSAasi88IowmuR1h/4W91P+vjSFG9xlHFvcNG3KePtrFHBc9XREXc1k5toDxaoT/kiHLN+anyvUTI7BBlFIrcjh7KBA55/rigk+T1cn2F/RMVrfEYsJtyT1/cEc5X5CyFArG+b964V/ZgZdAgP7EMmlkfm4o5+xZp2r3S2e3CsHgaGQeAzLVSrSfIFOn2YWPBbWQCpoeHOPgOAudeLvseOIkEfSJdlxWzMoYpvy83fbEobYRneYXtOa9e6ZyO3ogZN0nKM2I1FxizN128bL3a6Ycoaox84cK32d8jh3fgeFCjcT7mMV+/tvHT6WeY5v8Scyg1qUkkgiQiZ3gM8erXdm4Tyds4Jiunf4do+PpZkXE+rkiMR3Hly7QlpD5O9t1itdnATY5/8eY=
